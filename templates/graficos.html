<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos - Fast4You Admin</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .chart-container { width: 80%; margin: 0 auto 40px; }
        canvas { max-width: 100%; }
        h1 { text-align: center; }
    </style>
</head>
<body>
    <h1>Dashboard de Gráficos - Fast4You</h1>
    
    <div class="chart-container">
        <h2>Categoria com Mais Restaurantes</h2>
        <canvas id="chartCategoriasRestaurantes"></canvas>
    </div>
    
    
    <div class="chart-container">
        <h2>Planos Mais Populares</h2>
        <canvas id="chartPlanosAssinaturas"></canvas>
    </div>
    
    
    <div class="chart-container">
        <h2>Assinaturas por Mês</h2>
        <canvas id="chartAssinaturasMensal"></canvas>
    </div>

    <script>
        // Função para buscar dados e criar gráfico
        async function loadChart(endpoint, canvasId, type, labelKey, dataKey, title) {
            try {
                const res = await fetch(endpoint, { credentials: 'include' });
                const data = await res.json();
                const ctx = document.getElementById(canvasId).getContext('2d');
                
                const labels = data.map(item => item[labelKey]);
                const values = data.map(item => item[dataKey]);
                
                new Chart(ctx, {
                    type: type,  // 'bar', 'pie', 'line'
                    data: {
                        labels: labels,
                        datasets: [{
                            label: title,
                            data: values,
                            backgroundColor: type === 'pie' ? ['#FF6384', '#36A2EB', '#FFCE56'] : '#36A2EB',
                            borderColor: '#fff',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { display: type === 'pie' }
                        }
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar gráfico:', error);
            }
        }

        // Carregar todos os gráficos ao carregar a página
        document.addEventListener('DOMContentLoaded', () => {
            loadChart('/api/graficos/categorias-restaurantes', 'chartCategoriasRestaurantes', 'bar', 'categoria', 'total', 'Total de Restaurantes');
            loadChart('/api/graficos/restaurantes-assinaturas', 'chartRestaurantesAssinaturas', 'bar', 'restaurante', 'total_assinaturas', 'Total de Assinaturas');
            loadChart('/api/graficos/planos-assinaturas', 'chartPlanosAssinaturas', 'pie', 'plano', 'total', 'Distribuição de Planos');
            loadChart('/api/graficos/categorias-assinaturas', 'chartCategoriasAssinaturas', 'bar', 'categoria', 'total_assinaturas', 'Total de Assinaturas');
            loadChart('/api/graficos/usuarios-admin', 'chartUsuariosAdmin', 'pie', 'tipo', 'total', 'Distribuição de Usuários');
            loadChart('/api/graficos/assinaturas-mensal', 'chartAssinaturasMensal', 'line', 'mes', 'total', 'Assinaturas por Mês');
        });
    </script>
</body>
</html>